# Dwolla SDK for PHP

This repository contains the source code for Dwolla's PHP-based SDK as generated by [this fork of swagger-codegen](https://github.com/mach-kernel/swagger-codegen), which allows developers to interact with Dwolla's server-side API via a PHP API. Any action that can be performed via an HTTP request can be made using this SDK when executed within a server-side environment.

**Note:** Temporary PHP 7.4 support was added using these replacements:
- `\$this\->([a-z0-9\_]+) = \$data\["([a-z0-9\_]+)"\]\;` into `\$this->$1 = \$data\["$2"\] ?? null;`


## Table of Contents

- [Getting Started](#getting-started)
  - [Installation](#installation)
  - [Initialization](#initialization)
    - [Tokens](#tokens)
- [Making Requests](#making-requests)
  - [High-Level Requests](#high-level-requests)
    - [Setting Headers](#setting-headers)
- [Changelog](#changelog)
- [Community](#community)
- [Additional Resources](#additional-resources)
- [Credits](#credits)

## Getting Started

### Installation

To begin using this SDK, you will first need to download it to your machine. We use [Packagist](https://packagist.org/packages/dwolla/dwollaswagger) to distribute this package from where you can  download it via [Composer](https://getcomposer.org/).

```shell
$ composer require dwolla/dwollaswagger
$ composer install
```

To use, just `require` your composer `autoload.php` file.
```php
require('../path/to/vendor/autoload.php');
```

### Initialization

Before any API requests can be made, you must first determine which environment you will be using, as well as fetch the application key and secret. To fetch your application key and secret, please visit one of the following links:

* Production: https://dashboard.dwolla.com/applications
* Sandbox: https://dashboard-sandbox.dwolla.com/applications

Finally, you can create an instance of `ApiClient` after configuring the `username` and `password` values as the application key and secret that you fetched from one of the aforementioned links, respectively.

```php
DwollaSwagger\Configuration::$username = 'API_KEY';
DwollaSwagger\Configuration::$password = 'API_SECRET';

# For Sandbox
$apiClient = new DwollaSwagger\ApiClient("https://api-sandbox.dwolla.com");

# For production
$apiClient = new DwollaSwagger\ApiClient("https://api.dwolla.com");
```

#### Tokens

Application access tokens are used to authenticate against the API on behalf of an application. Application tokens can be used to access resources in the API that either belong to the application itself (`webhooks`, `events`, `webhook-subscriptions`) or the Dwolla Account that owns the application (`accounts`, `customers`, `funding-sources`, etc.). Application tokens are obtained by using the [`client_credentials`](https://tools.ietf.org/html/rfc6749#section-4.4) OAuth grant type:


```php
$tokensApi = new DwollaSwagger\TokensApi($apiClient);

$appToken = $tokensApi->token();
```

_Application access tokens are short-lived: 1 hour. They do not include a `refresh_token`. When it expires, generate a new one using `client.Auth.client()`._

## Making Requests

The Dwolla client provides high-level methods for interacting with the Dwolla API.

### High-Level Requests

High-level methods makes things easier by embedding information
you would typically refer to the docs for in the SDK itself such as endpoints, request parameters, and response parameters. `DwollaSwagger` contains `API` modules which allow the user to make requests, as well as `models` which are [DAOs](https://en.wikipedia.org/wiki/Data_access_object) that the library uses to serialize responses.

Each model represents the different kinds of requests and responses that can be made with the Dwolla API. View the full list in the [models directory](https://github.com/Dwolla/dwolla-swagger-php/tree/master/lib/models).

The following API modules are available:

* [`AccountsApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/accounts.md)
* [`BeneficialownersApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/BeneficialownersApi.md)
* [`BusinessclassificationsApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/BusinessclassificationsApi.md)
* [`CustomersApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Customers.md)
* [`DocumentsApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Documents.md)
* [`EventsApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Events.md)
* [`FundingsourcesApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/FundingSources.md)
* [`KbaApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Kbas.md)
* [`LabelsApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Labels.md)
* [`LabelreallocationsApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Labelreallocations.md)
* [`LedgerentriesApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Ledgerentries.md)
* [`MasspaymentitemsApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/high_level_requests/accounts.md)
* [`MasspaymentsApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Masspayments.md)
* [`OndemandauthorizationsApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Ondemandauthorizations.md)
* [`RootApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Root.md)
* [`SandboxApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Sandbox.md)
* [`TokensApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Tokens.md)
* [`TransfersApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Transfers.md)
* [`WebhooksApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippets/Webhooks.md)
* [`WebhooksubscriptionsApi`](https://github.com/Dwolla/dwolla-v2-kotlin/blob/main/docs/snippetsWebhooksubscriptions.md)

#### Setting Headers

You can pass custom headers in your requests as per the schema of the API models. Here is an example of creating a Customer with an [Idempotency-Key](https://developers.dwolla.com/api-reference#idempotency-key) header.

```php
<?php
$customersApi = new DwollaSwagger\CustomersApi($apiClient);

$customer = $customersApi->create([
  'firstName' => 'Jane',
  'lastName' => 'Merchant',
  'email' => 'jmerchant@nomail.net',
  'type' => 'receive-only',
  'businessName' => 'Jane Corp llc',
  'ipAddress' => '99.99.99.99'
], 
[
  'Idempotency-Key' => '51a62-3403-11e6-ac61-9e71128cae77'
]);
$customer; # => "https://api-sandbox.dwolla.com/customers/fc451a7a-ae30-4404-aB95-e3553fcd733f"
?>
```

## Changelog

1.7.0
* New `getCustomerCardToken` method added to `CustomersAPI` for creating a card funding sources token for a customer.

1.6.0
* New `TokenApi` adding support for application access token and client token requests.

1.5.0
* API schema updated, `CustomersApi` updated to add support for `email` parameter on list customers.

1.4.1
* Fix bug in [#43](https://github.com/Dwolla/dwolla-swagger-php/pull/43) to replace null-coalesce operator with backwards-compatible ternary. 

1.4.0
* Add temporary support fix for PHP 7.4. [Issue #41](https://github.com/Dwolla/dwolla-swagger-php/issues/41). (Thanks @oprypkhantc!)

1.3.0
* Add support for custom headers on all requests. (e.g. [Idempotency-Key](https://developers.dwolla.com/api-reference#idempotency-key) header)

1.2.0
* API schema updated, `CustomersApi` updated to support KBA related endpoint.
* New `KbaApi`.
* Existing `Document` model updated.
* New `AnswerKbaQuestionsRequest`, `AnswerKbaQuestionsResponse`, `AnsweredKbaQuestion`, `KbaQuestion.php`, `KbaAnswer` models.

1.1.0
* API schema updated, `CustomersApi` updated to support Labels related endpoints.
* New `LabelsApi`, `LabelreallocationsApi`, and `LedgerentriesApi`.
* Existing `CreateCustomer`, `Customer`, `MassPaymentRequestBody`, `MassPaymentRequestBody`, `Owner`, `Transfer`, `TransferRequestBody` and `UpdateCustomer` models updated.
* New `AddLabelLedgerEntryRequest`, `CreateCustomerLabelRequest`, `Label`, `LabelListResponse`, `LabelReallocation`, `LabelReallocationRequest`, `LedgerEntry`, and `LedgerEntryListResponse` models.

1.0.20
* Fix previously patched issue with parsing Location header in 201 response in ApiClient.

1.0.19
* Patch 201 response in ApiClient.

1.0.18
* Patch controller in CreateCustomer model.

1.0.17
* API schema updated, `CustomersApi` updated to support beneficial owner related endpoints, as well as support added for status filter on Customer search.
* New `BeneficialownersApi`.
* Existing `CreateCustomer`, `CreateFundingSourceRequest`, `Customer`, `FundingSourceBalance`, `TransferFailure`, and `UpdateCustomer` models updated.
* New `Address`, `BeneficialOwnerListResponse`, `CertifyRequest`, `CreateOwnerRequest`, `FullAccountInfo`, `Owner`, `Ownership`, `Passport`, and `UpdateOwnerRequest` models.

1.0.16
* API schema updated, `FundingsourcesApi` updated to support update a funding source. `MasspaymentsApi` and `MasspaymentitemsApi` updated to support filtering by correlationId.
* New `SandboxApi` which is used to simulate bank transfer processing in the Sandbox.
* Existing `CreateFundingSourceRequest`, `FundingSource`, `MassPayment`, `MassPaymentItem`, `MassPaymentItemRequestBody`, `MassPaymentRequestBody`, `Transfer`, `TransferFailure`, and `TransferRequestBody` models updated.
* New `ProcessResult`, `UpdateBankRequest`, and `UpdateJobRequestBody` models.

1.0.15
* Optional parameters set to null.

1.0.14
* Trim trailing slash from host url on initialization.

1.0.13
* Add control over IPV4 and V6 connections.

1.0.12
* API schema updated, `CustomersApi` updated to allow for null limit, offset, and search. Existing `CreateFundingSourceRequest`, `FundingSource`, `HalLink`, `MicroDepositsInitiated`, `Transfer`, and `TransferRequestBody` models updated. New `Clearing` and `FailureDetails` models.
* Fix README example for creating a Customer.

1.0.11
* API schema updated, `WebhooksubscriptionsApi` supports pause a webhook subscription. `FundingsourcesApi` contains support for `removed` parameter on list funding sources.
* Fix getFeesBySource to support deserialization with new `FeesBySourceResponse` model.

1.0.10
* Patch soft delete to deserialize with FundingSource model.

1.0.9
* Add boolean type to fix deserialization

1.0.8
* API schema updated, `FundingSourcesApi` supports balance check endpoint
* Fix transfer failure to support deserialization with new transfer failure model.

1.0.7
* API schema updated, `CustomersAPI` supports Customer search, new softDelete method in `FundingSourcesApi`.

1.0.6
* API schema updated, `TransfersApi` has new endpoints for cancel a transfer and get a transfer's fees, new `OndemandauthorizationsApi`, new `MasspaymentsApi`.
* Existing `Document`, `CreateFundingSourceRequest`, and `TransferRequestBody` models updated, new `MassPayment`, `Authorization`, `UpdateTransfer`, and `FacilitatorFeeRequest` models.

1.0.5
* API schema error fixed, `FundingSource` object now has `_embedded` key to fix serialization issues.

1.0.4
* Avoid use of function names if found in list of PHP reserved words.
* API schema updated, `CustomersApi` has new endpoints for IAV verification.
* Existing `Customer` related models updated, new `VerificationToken` model.
* (release skipped, features in 1.0.5)

1.0.3
* API schema updated, `RootApi` now added.
* Changed `auth_token` to `access_token` in compliance with [RFC-6749](https://tools.ietf.org/html/rfc6749) recommended nomenclature.

1.0.2
* API schema updated, new methods in `FundingsourcesApi`.
* All methods which take Swagger variables in `path` (e.g, `/resource/{id}`) can now be passed a resource URL to make it easier for HAL-styled API consumption.
* More idiomatic response logic for HTTP 201 responses.

1.0.1
* API schema updated, new methods in `CustomersApi` and `TransfersApi`

1.0.0
* Initial release.

## Community
* If you have any feedback, please reach out to us on [our forums](https://discuss.dwolla.com/) or by [creating a GitHub issue](https://github.com/Dwolla/dwolla-v2-php/issues/new).
* If you would like to contribute to this library, [bug reports](https://github.com/Dwolla/dwolla-v2-php/issues) and [pull requests](https://github.com/Dwolla/dwolla-v2-php/pulls) are always appreciated!

## Additional Resources

To learn more about Dwolla and how to integrate our product with your application, please consider visiting the following resources and becoming a member of our community!

* [Dwolla](https://www.dwolla.com/)
* [Dwolla Developers](https://developers.dwolla.com/)
* [SDKs and Tools](https://developers.dwolla.com/sdks-tools)
 * [Dwolla SDK for C#](https://github.com/Dwolla/dwolla-v2-csharp)
 * [Dwolla SDK for Kotlin](https://github.com/Dwolla/dwolla-v2-kotlin)
 * [Dwolla SDK for Node](https://github.com/Dwolla/dwolla-v2-node)
 * [Dwolla SDK for Python](https://github.com/Dwolla/dwolla-swagger-python)
 * [Dwolla SDK for Ruby](https://github.com/Dwolla/dwolla-v2-ruby)
* [Developer Support Forum](https://discuss.dwolla.com/)

## Credits

This wrapper is semantically generated by a fork of [swagger-codegen](http://github.com/mach-kernel/swagger-codegen).
 - [swagger-codegen contributors](https://github.com/swagger-api/swagger-codegen/network/members)
 - [David Stancu](http://github.com/mach-kernel)
